# Enterprise Sitemap Architecture - IndiaToolkit.in

## Overview

This document describes the enterprise-level sitemap system implemented for IndiaToolkit.in, designed to handle millions of URLs efficiently while optimizing Google's crawl budget.

## Architecture

### Multi-Sitemap Structure

```
sitemap.xml (Index)
├── sitemap-tools.xml      # All tool pages
├── sitemap-categories.xml # All category pages
├── sitemap-pages.xml      # Static and informational pages
└── sitemap-blog.xml       # Future: Blog posts (ready)
```

### File Structure

```
app/
├── sitemap.ts              # Sitemap index
├── sitemap-tools.ts        # Tools sitemap
├── sitemap-categories.ts   # Categories sitemap
├── sitemap-pages.ts        # Static pages sitemap
└── robots.ts               # Robots.txt configuration

lib/
└── sitemap-utils.ts        # Sitemap utilities and helpers

data/
├── tools.ts                # Tools database
└── categories.ts           # Categories database
```

## Features

### 1. URL Safety & Validation

- **Double-slash prevention**: Automatically removes `//` from URLs
- **Trailing slash handling**: Consistent URL format
- **Query parameter removal**: Prevents duplicate content
- **Invalid URL filtering**: Removes malformed URLs

```typescript
// Example: URL sanitization
sanitizeUrlPath("//tool//example//") // Returns: "/tool/example"
sanitizeUrlPath("/tool/example/")   // Returns: "/tool/example"
sanitizeUrlPath("/tool?filter=new") // Returns: "/tool"
```

### 2. Dynamic Priority System

Priority is calculated based on multiple factors:

| Tool Type | Base Priority | Boost Factors |
|-----------|---------------|---------------|
| Popular | 0.9 | +0.05 if rating ≥ 4.5 |
| New | 0.8 | +0.05 if usage > 10K |
| Normal | 0.7 | +0.03 if featured |

| Category Size | Priority |
|---------------|----------|
| 20+ tools | 0.85 |
| 10-19 tools | 0.75 |
| 5-9 tools | 0.70 |
| <5 tools | 0.60 |

### 3. Intelligent Change Frequency

| Content Type | Frequency | Reason |
|--------------|-----------|--------|
| Popular tools | Daily | High traffic, frequent updates |
| New tools | Weekly | Fresh content discovery |
| Normal tools | Monthly | Stable content |
| Categories (20+ tools) | Weekly | Active categories |
| Categories (<20 tools) | Monthly | Stable categories |
| Static pages | Monthly/Yearly | Rarely change |

### 4. Real Last Modified Dates

The system uses actual data for lastModified:

1. **First priority**: `tool.lastUpdated` field
2. **Second priority**: `tool.createdAt` field
3. **Fallback**: Recent date for new/popular tools
4. **Never**: Fake current date for all pages

### 5. Indexing Safety Rules

Automatically excluded from sitemaps:

- `/login` - Authentication pages
- `/signup` - Authentication pages
- `/profile` - User-specific pages
- `/settings` - User-specific pages
- `/history` - User-specific pages
- `/saved-tools` - User-specific pages
- `/private/*` - Private routes
- `/admin/*` - Admin routes
- `/api/*` - API endpoints
- `/*?*` - URLs with query parameters

### 6. Crawl Budget Optimization

- **Priority sorting**: High-priority URLs listed first
- **Deduplication**: Removes duplicate URLs
- **Size limits**: Max 500 URLs per sitemap
- **Clean URLs**: No query parameters or fragments

## Usage

### Generating Sitemaps

Sitemaps are automatically generated by Next.js when accessed:

```
GET /sitemap.xml           → Sitemap index
GET /sitemap-tools.xml     → Tools sitemap
GET /sitemap-categories.xml → Categories sitemap
GET /sitemap-pages.xml     → Pages sitemap
```

### Adding New Tools

New tools are automatically included in the sitemap when added to `data/tools.ts`:

```typescript
{
  id: "new-tool",
  name: "New Tool",
  slug: "new-tool",
  category: "dev-tools",
  isNew: true,  // Gets priority 0.8 and weekly frequency
  // ... other fields
}
```

### Adding New Categories

New categories are automatically included when added to `data/categories.ts`:

```typescript
{
  id: "new-category",
  name: "New Category",
  slug: "new-category",
  featured: true,  // Gets priority boost
  // ... other fields
}
```

## Scaling for Millions of Pages

### Chunking Strategy

When a sitemap exceeds 500 URLs, it's automatically chunked:

```typescript
// lib/sitemap-utils.ts
export function chunkSitemaps(urls: SitemapEntry[], maxUrls = 500): SitemapChunk[]
```

This creates:
- `sitemap-tools-1.xml`
- `sitemap-tools-2.xml`
- `sitemap-tools-3.xml`
- etc.

### Future Enhancements

1. **Incremental Generation**: Generate sitemaps on-demand for large datasets
2. **Edge Runtime**: Deploy sitemap generation to edge for faster response
3. **CDN Caching**: Cache sitemaps at CDN level
4. **Compression**: Enable gzip compression for large sitemaps

## Monitoring

### Development Logging

In development mode, sitemap stats are logged:

```
[Sitemap:Tools] {
  totalUrls: 150,
  avgPriority: 0.74,
  priorityDistribution: { '0.9': 20, '0.8': 15, '0.7': 115 },
  changeFrequencyDistribution: { daily: 20, weekly: 15, monthly: 115 }
}
```

### Google Search Console

Monitor these metrics:
- Sitemap submission status
- Indexed vs submitted pages
- Crawl errors
- Coverage issues

## Best Practices

### DO ✅

- Use real lastModified dates
- Set appropriate priorities
- Include only indexable pages
- Keep URLs clean and consistent
- Update sitemaps when content changes

### DON'T ❌

- Use fake dates for all pages
- Include user-specific pages
- Add URLs with query parameters
- Hardcode all priorities
- Include duplicate URLs

## Technical Reference

### SitemapEntry Interface

```typescript
interface SitemapEntry {
  url: string;
  lastModified?: Date | string;
  changeFrequency?: 'always' | 'hourly' | 'daily' | 'weekly' | 'monthly' | 'yearly' | 'never';
  priority?: number;
}
```

### Utility Functions

| Function | Purpose |
|----------|---------|
| `sanitizeUrlPath()` | Clean and validate URL paths |
| `shouldIncludeUrl()` | Determine if URL should be in sitemap |
| `deduplicateUrls()` | Remove duplicate URLs |
| `calculateToolPriority()` | Calculate dynamic priority for tools |
| `calculateCategoryPriority()` | Calculate priority for categories |
| `calculateToolChangeFrequency()` | Determine change frequency |
| `getToolLastModified()` | Get real lastModified date |
| `generateToolEntry()` | Create sitemap entry for tool |
| `generateCategoryEntry()` | Create sitemap entry for category |
| `chunkSitemaps()` | Split large sitemaps |
| `validateAndCleanEntries()` | Validate and clean all entries |

## Performance

### Expected Performance

| Metric | Target |
|--------|--------|
| Sitemap generation | < 100ms |
| Sitemap size | < 50KB (uncompressed) |
| URLs per sitemap | ≤ 500 |
| Total sitemaps | Scalable |

### Optimization Tips

1. **Enable ISR**: Use Incremental Static Regeneration for sitemaps
2. **Cache headers**: Set appropriate cache-control headers
3. **CDN**: Serve sitemaps from CDN
4. **Compression**: Enable gzip/brotli compression

---

*Last updated: February 2026*
*Version: 2.0.0*
